<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <title>Music player</title>
  <link rel="stylesheet" href="./style.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.css">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap');

    #seek-slider {
      -webkit-appearance: none;
      width: 100%;
      height: 6px;
      background: #ddd;
      border-radius: 5px;
      outline: none;
      margin: 5px 0;
    }

    #seek-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 14px;
      height: 14px;
      background: #333;
      border-radius: 50%;
      cursor: pointer;
    }

    #seek-slider::-moz-range-thumb {
      width: 14px;
      height: 14px;
      background: #333;
      border-radius: 50%;
      cursor: pointer;
    }

    .time-display {
      display: flex;
      justify-content: space-between;
      font-size: 12px;
      color: #555;
      margin-top: -5px;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <div class="music-player">
    <div class="notification" hidden>Пісні не знайдені</div>

    <div class="search-bar">
      <form class="search-form">
        <div class="search-input-container">
          <input type="text" id="searchInput" placeholder="Введіть назву пісні...">
          <button id="btnc" type="submit" class="search-button">
            <i class="bi bi-search"></i>
          </button>
        </div>
      </form>
    </div>

    <div class="album-art">
      <img id="img" src="./demo.jpg" alt="Album Cover" class="album-cover" />
    </div>

    <div class="song-info">
      <div id="nameMusic" class="song-title">Демо пісня</div>
      <div id="artistN" class="artist">Виконавець</div>
    </div>

    <div class="time-info">
      <input type="range" id="seek-slider" max="0" value="0">
      <div class="time-display">
        <span id="current-time">0:00</span>
        <span id="duration-time">0:00</span>
      </div>
    </div>

    <div class="player-controls">
      <button id="myButtonE" class="control-button prev-button">
        <i class="bi bi-skip-start-fill"></i>
      </button>
      <play-button>
        <audio loop id="aud" src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3"></audio>
        <button class="control-button play-pause-button">
          <i class="bi bi-play-fill"></i>
        </button>
      </play-button>
      <button id="myButton" class="control-button next-button">
        <i class="bi bi-skip-end-fill"></i>
      </button>
    </div>
  </div>

  <script>
    const seekSlider = document.getElementById('seek-slider');
    const audio = document.getElementById('aud');
    const btnSearch = document.getElementById('btnc');
    const searchInput = document.getElementById('searchInput');
    const btnNext = document.getElementById('myButton');
    const btnPrev = document.getElementById('myButtonE');
    const artistN = document.getElementById('artistN');
    const imgCover = document.getElementById('img');
    const nameMusic = document.getElementById('nameMusic');
    const currentTimeDisplay = document.getElementById('current-time');
    const durationTimeDisplay = document.getElementById('duration-time');
    let counterNum = 0;

    class PlayButton extends HTMLElement {
      static register(tagName) {
        customElements.define(tagName || 'play-button', PlayButton);
      }
      connectedCallback() {
        this.button.addEventListener('click', () => {
          if (this.player.paused) {
            this.player.play();
            this.button.innerHTML = '<i class="bi bi-pause-fill"></i>';
          } else {
            this.player.pause();
            this.button.innerHTML = '<i class="bi bi-play-fill"></i>';
          }
        });
      }
      get player() { return this.querySelector('audio'); }
      get button() { return this.querySelector('button'); }
    }
    PlayButton.register();

    function formatTime(seconds) {
      const min = Math.floor(seconds / 60);
      const sec = Math.floor(seconds % 60);
      return `${min}:${sec < 10 ? '0' + sec : sec}`;
    }

    function searchTrack(e) {
      e.preventDefault();
      const term = encodeURIComponent(searchInput.value);
      fetch(`https://itunes.apple.com/search?term=${term}&media=music&country=UA`)
        .then(res => res.ok ? res.json() : Promise.reject('Network error'))
        .then(data => {
          if (data.results.length > 0) {
            const track = data.results[counterNum];
            audio.src = track.previewUrl;
            audio.load();
            audio.play();
            artistN.textContent = track.artistName;
            imgCover.src = track.artworkUrl100;
            nameMusic.textContent = track.collectionCensoredName;
          } else {
            alert('Нічого не знайдено(');
          }
        })
        .catch(err => console.error('Помилка:', err));
    }

    btnSearch.addEventListener('click', searchTrack);
    btnNext.addEventListener('click', () => { counterNum++; searchTrack(new Event('click')); });
    btnPrev.addEventListener('click', () => { counterNum--; searchTrack(new Event('click')); });

    audio.addEventListener('loadedmetadata', () => {
      seekSlider.max = Math.floor(audio.duration);
      durationTimeDisplay.textContent = formatTime(audio.duration);
    });

    audio.addEventListener('timeupdate', () => {
      seekSlider.value = Math.floor(audio.currentTime);
      currentTimeDisplay.textContent = formatTime(audio.currentTime);
    });

    seekSlider.addEventListener('input', () => {
      audio.currentTime = seekSlider.value;
    });
  </script>
</body>
</html>
